<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.StringParameterDefinition>
          <name>VECTORCAST_DIR</name>
          <description>Vectorcast directory</description>
          <defaultValue>/home/vectorindia/vcast_64u</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>summary_file</name>
          <description></description>
          <defaultValue>summary.txt</defaultValue>
        </hudson.model.StringParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <scm class="hudson.scm.NullSCM"/>
  <assignedNode>Firefox_linux</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers/>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command>#!/bin/bash -xe

#function to handle error 
handle_error()
{
	export _error_=$?
	if [ ! &quot;$_error_&quot; == &quot;0&quot; ];then
		echo &quot;      Command failed &quot; &gt;&gt; $summary_file
		export _RETURN_CODE_=$_error_
	fi
}

#Set up Environment varaibles
export VECTOR_LICENSE_FILE=/home/vectorindia/vector-license/vector-VECTORINDIA.lic
export PYTHONPATH=/usr/lib/python2.7/dist-packages:PYTHONPATH

#Print tools version in console for reference
$VECTORCAST_DIR/vcshell --version
$VECTORCAST_DIR/clicast --version

#Copy the firefox source 
cp -r /home/vectorindia/firefox/firefox/* $WORKSPACE/.

. ./make_config

#print VcTools version in log file
echo &quot;---- Results for VcTools Version : ` $VECTORCAST_DIR/vcshell --version | grep Version | awk &apos;{print $3}&apos;` &quot; &gt;&gt; $summary_file
echo  &gt;&gt; $summary_file


#Execute and measure timings for vcshell make -j4
echo &quot;    Vcshell make -j4 &quot; &gt;&gt; $summary_file
time ($VECTORCAST_DIR/vcshell --db=pristine_vcshell.db make -j4 &gt;vcshell_make.out.txt 2&gt;&amp;1) 2&gt;&gt; $summary_file || handle_error
echo  &gt;&gt; $summary_file

#Execute and measure timings for vcshell metrics -j4
echo &quot;    Vcshell metrics -j4 &quot; &gt;&gt; $summary_file
time ($VECTORCAST_DIR/vcshell --flags=&quot;-include=1,-f=1,-std=gnu++0x,-m=1,-W=1&quot; --metrics make -j4 &gt;vcshell_metrics.out.txt 2&gt;&amp;1) 2&gt;&gt; $summary_file || handle_error
echo  &gt;&gt; $summary_file

#Execute and mesaure timings for getmetrics
echo &quot;   Vcdb Getmetrics for vcshell --metrics &quot;  &gt;&gt; $summary_file
time ($VECTORCAST_DIR/vcdb getmetrics &gt; vcdb_getmetrics_for_vcshell_metrics.out.txt 2&gt;&amp;1 ) 2 &gt;&gt;$summary_file || handle_error
echo &gt;&gt; $summary_file

#Execute and measure timings for clearmetrics
cp vcshell.db vcutil_metrics.db
echo &quot;   Vcdb clearmetrics &quot;  &gt;&gt; $summary_file
time ($VECTORCAST_DIR/vcdb clearmetrics --db=vcutil_metrics.db &gt; vcdb_clearmetrics.out.txt 2&gt;&amp;1 ) 2&gt;&gt; $summary_file || handle_error
echo &gt;&gt; $summary_file

#Execute and measure timings for vcutil addmetrics
echo &quot;  Vcutil addmetrics &quot;  &gt;&gt; $summary_file
time ($VECTORCAST_DIR/vcutil --db=vcutil_metrics.db  --flags=&quot;-include=1,-f=1,-std=gnu++0x,-m=1,-W=1&quot; --all addmetrics &gt; vcutil_addmetrics.out.txt 2&gt;&amp;1)&gt; 2 &gt;&gt; $summary_file || handle_error
echo &gt;&gt; $summary_file

#Verify metrics recorded in vcutil
echo &quot;   Vcdb Getmetrics for vcutil addmetrics &quot;  &gt;&gt; $summary_file
time ($VECTORCAST_DIR/vcdb getmetrics &gt; vcdb_getmetrics_for_vcshell_metrics.out.txt 2&gt;&amp;1 ) 2 &gt;&gt;$summary_file || handle_error
echo &gt;&gt; $summary_file

exit /b $_RETURN_CODE_



</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers>
    <hudson.tasks.ArtifactArchiver>
      <artifacts>mozilla-release/obj-x86_64-unknown-linux-gnu/*.out.txt, mozilla-release/obj-x86_64-unknown-linux-gnu/summary.txt</artifacts>
      <allowEmptyArchive>false</allowEmptyArchive>
      <onlyIfSuccessful>false</onlyIfSuccessful>
      <fingerprint>false</fingerprint>
      <defaultExcludes>true</defaultExcludes>
      <caseSensitive>true</caseSensitive>
    </hudson.tasks.ArtifactArchiver>
    <hudson.tasks.Mailer plugin="mailer@1.19">
      <recipients>shekhar.singh@vectorcast.com</recipients>
      <dontNotifyEveryUnstableBuild>false</dontNotifyEveryUnstableBuild>
      <sendToIndividuals>false</sendToIndividuals>
    </hudson.tasks.Mailer>
  </publishers>
  <buildWrappers>
    <hudson.plugins.ws__cleanup.PreBuildCleanup plugin="ws-cleanup@0.32">
      <deleteDirs>false</deleteDirs>
      <cleanupParameter></cleanupParameter>
      <externalDelete></externalDelete>
    </hudson.plugins.ws__cleanup.PreBuildCleanup>
  </buildWrappers>
</project>