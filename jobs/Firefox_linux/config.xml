<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.StringParameterDefinition>
          <name>LINUX_VECTORCAST_DIR</name>
          <description>Vectorcast directory</description>
          <defaultValue>/home/vectorindia/.VCAST_REGRESSION</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>summary_file</name>
          <description></description>
          <defaultValue>summary.txt</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>top_level_archive_dir</name>
          <description></description>
          <defaultValue>/mnt/nfs/shared/firefox_results/linux</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>BUILD_NAME</name>
          <description></description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <scm class="hudson.scm.NullSCM"/>
  <assignedNode>Firefox_linux</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers>
    <org.jenkinsci.plugins.parameterizedscheduler.ParameterizedTimerTrigger plugin="parameterized-scheduler@0.2">
      <spec></spec>
      <parameterizedSpecification>0 20 * * *</parameterizedSpecification>
    </org.jenkinsci.plugins.parameterizedscheduler.ParameterizedTimerTrigger>
  </triggers>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command>#!/bin/bash -xe

#function to handle error 
handle_error()
{
	export _error_=$?
	if [ ! &quot;$_error_&quot; == &quot;0&quot; ];then
		echo &quot;      Command failed &quot;
		export _RETURN_CODE_=$_error_
	fi
}
#global variable to hold variable
_var_=&quot;--&quot;
#function to generate tabular file
Extract()
{
output=`grep &quot;user&quot; $1 | awk &apos;{printf(&quot;%s&quot;,$2)}&apos;`
grep &quot;user&quot; $1 | awk &apos;{printf(&quot;\t         %s    \t&quot;,$2)}&apos;&gt;&gt;$summary_file
echo -n -e &quot;        $_var_       &quot; &gt;&gt;$summary_file
_var_=&quot;--&quot;
out=`echo $output | awk &apos;{split ($0,a,&quot;m&quot;);print a[1]}&apos;`
if  [ $out -ge $2 ] &amp;&amp; [ $out -le $3 ] 
then 
echo -e &quot;Passed&quot;&gt;&gt;$summary_file
else
echo -e &quot;Failed&quot;&gt;&gt;$summary_file
fi
}
#secondary function to help generate Extract format
Extract2()
{
if [ &quot;$2&quot; == &quot;vcdb__getfiles&quot; ]
then  
_var_=`cat $2 | grep &quot;Count&quot; | awk &apos;{print $3}&apos;`
else
_var_=`cat $2 | wc -l`
fi
Extract $1 $3 $4
}
#Set up Environment varaibles
export VECTORCAST_DIR=${LINUX_VECTORCAST_DIR}
export VECTOR_LICENSE_FILE=/home/vectorindia/vector-license/vector-VECTORINDIA.lic
export PYTHONPATH=/usr/lib/python2.7/dist-packages:PYTHONPATH

#Print tools version in console for reference
$VECTORCAST_DIR/vcshell --version
$VECTORCAST_DIR/clicast --version

#Copy the firefox source 
cp -r /home/vectorindia/firefox/firefox/* $WORKSPACE/.
 
. ./make_config

#print VcTools version in log file
echo &quot;---- Results for VcTools Version : ` $VECTORCAST_DIR/vcshell --version | grep Version | awk &apos;{print $3}&apos;` &quot; &gt;&gt; $summary_file
echo  &gt;&gt; $summary_file

#tabular format for the file
echo -e  &quot;Command            \t           Time        \t  Artifact    \t Result  &quot; &gt;&gt;summary.txt

#Execute and measure timings for vcshell make -j8
echo -n -e &quot;Vchell make \t&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcshell --db=pristine_vcshell.db make -j8 &gt;vcshell_make.out.txt 2&gt;&amp;1) 2&gt;&gt; vcshell_make || handle_error
Extract vcshell_make 58 78

#Execute and measure timings for vcshell metrics -j8
make clean
echo -n -e &quot;Vcshell metrics\t&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcshell --flags=&quot;-include=1,-f=1,-std=gnu++0x,-m=1,-W=1&quot; --metrics make -j8 &gt;vcshell_metrics.out.txt 2&gt;&amp;1) 2&gt;&gt; vcshell_metrics || handle_error
Extract vcshell_metrics 132 152

#Execute and mesaure timings for getmetrics
echo -n -e &quot;Vcdb getmetrics\t&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcdb getmetrics &gt; vcdb_getmetrics_for_vcshell_metrics.out.txt 2&gt;&amp;1) 2&gt;&gt;vcdb_getmetrics || handle_error
Extract2 vcdb_getmetrics vcdb_getmetrics_for_vcshell_metrics.out.txt 0 1


#Execute and measure timings for clearmetrics
cp vcshell.db vcutil_metrics.db
echo -n -e &quot;Vcdb clearmetrics&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcdb clearmetrics --db=vcutil_metrics.db &gt; vcdb_clearmetrics.out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_clearmetrics || handle_error
Extract vcdb_clearmetrics 0 1

#Execute and measure timings for vcutil addmetrics
echo  -n -e &quot;Vcutil Addmetrics&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcutil --db=vcutil_metrics.db  --flags=&quot;-include=1,-f=1,-std=gnu++0x,-m=1,-W=1&quot; --all addmetrics -j8  &gt; vcutil_addmetrics.out.txt 2&gt;&amp;1) 2&gt;&gt; vcutil_addmetrics || true
Extract vcutil_addmetrics 142 178


#Verify metrics recorded in vcutil
echo -n -e &quot;Vcdb getmetrics\t&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcdb getmetrics &gt; vcdb_getmetrics_for_vcshell_metrics.out.txt 2&gt;&amp;1) 2&gt;&gt;vcdb_getmetrics_vcutil || handle_error
Extract2 vcdb_getmetrics_vcutil vcdb_getmetrics_for_vcshell_metrics.out.txt 0 1


#Vcutil Instrument 
echo -n -e &quot;Vcutil Instrument&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcutil  --db=vcutil_metrics.db --flags=&quot;-include=1,-f=1,-std=gnu++0x,-m=1,-W=1&quot; --all --jobs=4 --destination_dir=InstFiles --coverage_type=statement instrument -j8 &gt; vcutil_instr.out.txt 2&gt;&amp;1) 2&gt;&gt; vcutil_instrument || handle_error
Extract vcutil_instrument 110 140

#Vcutil Quick parse
echo -n -e &quot;Vcutil qikparse\t&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcutil --db=vcutil_metrics.db --flags=&quot;-include=1,-f=1,-std=gnu++0x,-m=1,-W=1&quot; --all --jobs=4 --destination_dir=Quick quickparse -j8 &gt; vcutil_quick.out 2&gt;&amp;1) 2&gt;&gt; vcutil_qikparse || handle_error
Extract vcutil_qikparse 65 95

#vcdb getfiles
echo -n -e &quot;Vcdb getfiles\t&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcdb getfiles &gt;vcdb_getfiles.out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb__getfiles || handle_error
Extract2 vcdb__getfiles vcdb__getfiles 0 1

#vcdb dumpcmd
echo -n -e &quot;Vcdb dumpcmd\t&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcdb dumpcommands &gt;vcdb_dumpcommand.out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_dump || handle_error
Extract vcdb_dump 0 1

#vcdb dumpverb
echo -n -e &quot;Vcdb dumpverb\t&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcdb dumpverbs &gt; vcdb_dumpverbs.out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_dumpv  || handle_error
Extract vcdb_dumpv 0 1

#vcdb getapps
echo -n -e &quot;Vcdb getapps\t&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcdb getapps &gt;vcdb_getapps.out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_getapps  || handle_error
Extract vcdb_getapps 0 1

#get commentdata
echo -n -e &quot;Vcdb getcommentdata&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcdb getcommentdata &gt; vcdb_getcommentdata.out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_getcommentdata || handle_error
Extract vcdb_getcommentdata 0 1

#get vcdb metrics
echo -n -e &quot;Vcdb getmetrics\t&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcdb getmetrics &gt; vcdb_getmetrics_data.out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_met  || handle_error
Extract vcdb_met 0 1

#get vcdb path
echo -n -e &quot;Vcdb getpaths\t&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcdb getpaths &gt; vcdb_getpaths_data.out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_getpath  || handle_error
Extract vcdb_getpath 0 1

#get vcdb tags
echo -n -e &quot;Vcdb gettags\t&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcdb gettags &gt; vcdb_gettags_data.out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_gettags || handle_error
Extract vcdb_gettags 0 1

#get linkcmd
echo -n -e &quot;Vcdb getlinkcmd\t&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcdb getlinkcmd &gt; vcdb_getlinkcmd_data.out.txt 2&gt;&amp;1) 2&gt;&gt;vcdb_getlinkcmd || handle_error
Extract vcdb_getlinkcmd 0 1

#get list
echo -n -e &quot;Vcdb list-prefixes&quot;&gt;&gt;$summary_file
time ($VECTORCAST_DIR/vcdb list-prefixes &gt; vcdb_list-prefixes_data.out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_getlist || handle_error
Extract vcdb_getlist 0 1

#getcmd.sh
echo -n -e &quot;Getcmd.sh\t&quot;&gt;&gt;$summary_file
chmod +x ../../getcmd.sh
time (../.././getcmd.sh vcdb_getfiles.out.txt &gt; getcommands_data.out.txt 2&gt;&amp;1) 2&gt;&gt; getcmd || handle_error
Extract getcmd 1 3

#getcommentdensity
echo -n -e &quot;GetcommentDensity.sh&quot;&gt;&gt;$summary_file
chmod +x ../../getcommentdensity.sh
time (../.././getcommentdensity.sh vcdb_getfiles.out.txt &gt; get_commentdensit_out.txt 2&gt;&amp;1) 2&gt;&gt; getcomment || handle_error
Extract getcomment 2 4

#getincludes
echo -n -e &quot;Getincludes.sh\t&quot;&gt;&gt;$summary_file
chmod +x ../../getincludes.sh
time (../.././getincludes.sh vcdb_getfiles.out.txt &gt; get_includes_out.txt 2&gt;&amp;1) 2&gt;&gt;vcdb_getinclude || handle_error
Extract vcdb_getinclude 0 1

#getdefines
echo -n -e &quot;Getdefines.sh\t&quot;&gt;&gt;$summary_file
chmod +x ../../getdefines.sh
time (../.././getdefines.sh vcdb_getfiles.out.txt &gt; get_defines_out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_getdefine || handle_error
Extract vcdb_getdefine 0 1

#getoptions
echo -n -e &quot;Getoptions.sh\t&quot;&gt;&gt;$summary_file
chmod +x ../../getoption.sh || handle_error
time (../.././getoption.sh vcdb_getfiles.out.txt &gt; get_options_out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_getoption || handle_error
Extract vcdb_getoption 1 4

#getpopt
echo -n -e &quot;Getpoptions.sh\t&quot;&gt;&gt;$summary_file
chmod +x ../../getppopt.sh || handle_error
time (../.././getppopt.sh vcdb_getfiles.out.txt &gt;get_poptions_out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_getpoption || handle_error
Extract vcdb_getpoption 2 4

#getuniindex
echo -n -e &quot;Getunitindex.sh\t&quot;&gt;&gt;$summary_file
chmod +x ../../getunitindex.sh || handle_error
time (../.././getunitindex.sh vcdb_getfiles.out.txt &gt;get_unitindex_out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_getunitindex || handle_error
Extract vcdb_getunitindex 0 1

#getpathtype
echo -n -e &quot;GetPathtype.sh\t&quot;&gt;&gt;$summary_file
chmod +x ../../getpathtype || handle_error
time (../.././getpathtype.sh vcdb_getfiles.out.txt &gt;get_pathtypes_out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_getpathtype || handle_error
Extract vcdb_getpathtype 0 1

#setpathtype
echo -n -e &quot;Setpathtype.sh\t&quot;&gt;&gt;$summary_file
chmod +x ../../setpathtype.sh || handle_error
time (../.././setpathtype.sh vcdb_getfiles.out.txt &gt; set_pathtypes_out.txt 2&gt;&amp;1) 2&gt;&gt; vcdb_setpathtype || true
Extract vcdb_setpathtype 0 1


#quick 
#Archive the artifacts
cd $top_level_archive_dir
archive_dir=$(date +%d)
if [ -d $archive_dir ];then
	rm -rf $archive_dir
fi
mkdir $archive_dir
cp $WORKSPACE/mozilla-release/obj-x86_64-unknown-linux-gnu/summary.txt $archive_dir/.
cp $WORKSPACE/mozilla-release/obj-x86_64-unknown-linux-gnu/*.out.txt $archive_dir/.

exit /b $_RETURN_CODE_



</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers>
    <hudson.plugins.emailext.ExtendedEmailPublisher plugin="email-ext@2.57">
      <recipientList>vectorindia@vectorcast.com</recipientList>
      <configuredTriggers>
        <hudson.plugins.emailext.plugins.trigger.AlwaysTrigger>
          <email>
            <recipientList>shekhar.singh@vectorcast.com</recipientList>
            <subject>Firefox Linux Result</subject>
            <body>Hello All,

${FILE,path=&quot;mozilla-release/obj-x86_64-unknown-linux-gnu/summary.txt&quot;}

Thanks,
Jenkins</body>
            <recipientProviders>
              <hudson.plugins.emailext.plugins.recipients.ListRecipientProvider/>
            </recipientProviders>
            <attachmentsPattern>mozilla-release/obj-x86_64-unknown-linux-gnu/summary.txt</attachmentsPattern>
            <attachBuildLog>false</attachBuildLog>
            <compressBuildLog>false</compressBuildLog>
            <replyTo>vectorinida@vectorcast.com</replyTo>
            <contentType>both</contentType>
          </email>
        </hudson.plugins.emailext.plugins.trigger.AlwaysTrigger>
      </configuredTriggers>
      <contentType>both</contentType>
      <defaultSubject>Firefox Linux Result</defaultSubject>
      <defaultContent>$DEFAULT_CONTENT</defaultContent>
      <attachmentsPattern>mozilla-release/obj-x86_64-unknown-linux-gnu/summary.txt</attachmentsPattern>
      <presendScript>$DEFAULT_PRESEND_SCRIPT</presendScript>
      <postsendScript>$DEFAULT_POSTSEND_SCRIPT</postsendScript>
      <attachBuildLog>false</attachBuildLog>
      <compressBuildLog>false</compressBuildLog>
      <replyTo>vectorindia@vectorcast.com</replyTo>
      <saveOutput>false</saveOutput>
      <disabled>false</disabled>
    </hudson.plugins.emailext.ExtendedEmailPublisher>
  </publishers>
  <buildWrappers>
    <hudson.plugins.ws__cleanup.PreBuildCleanup plugin="ws-cleanup@0.32">
      <deleteDirs>false</deleteDirs>
      <cleanupParameter></cleanupParameter>
      <externalDelete></externalDelete>
    </hudson.plugins.ws__cleanup.PreBuildCleanup>
    <org.jenkinsci.plugins.buildnamesetter.BuildNameSetter plugin="build-name-setter@1.6.5">
      <template>${ENV,var=&quot;BUILD_NAME&quot;}</template>
      <runAtStart>true</runAtStart>
      <runAtEnd>false</runAtEnd>
    </org.jenkinsci.plugins.buildnamesetter.BuildNameSetter>
  </buildWrappers>
</project>